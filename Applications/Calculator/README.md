The Calculator Application
===========

This application is a simple Android Calculator application that has two modes: Simple and
Scientific mode. Each mode is represented by an Activity.

This application illustrates JPF-Android input script and how it can be used to drive the execution of the application on JPF. 

The application can be used to detect an Arithmetic exception, using jpf-android,
that is thrown by the application when we divide by zero or ask for the
square root of a negative number. Lastly it can detect a NullPointer
dereferencing exception when sending data between Activities.

Dependencies
-----------

For the application to compile and run as an Android application from the command line / from Eclipse the following is required: 

 - The project makes use of [EvalEx](https://github.com/uklimaschewski/EvalEx), a Java Expression Evaluator to parse and evaluate expressions. This library needs to be downloaded, packaged into a jar and placed in the libs folder of the application. (Since there is no jar availble this is currently included. In future releases we will download this using gradle)

 - The project also depends on the jpf-android Checkpoint annotation found in the `jpf-android-annotaions.jar` file that is generated by jpf-android during the `src-dist` gradle task. The idea is also not to include this jar, but to download the current version from a online maven repo (future plans). For now it is included in the libs folder.


Building
--------
Although this project has the old Java application package structure used by the Android Eclipse plugin, the tool also makes use of both `gradle` and/or `ant` for building the project. 

**Eclipse:**

 1. Install the [Android ADT plugin](http://developer.android.com/sdk) for Eclipse and download Android SDK 19.

 2. Install the Egit plugin for Eclipse.

  
 3. (Optional) Install the Eclipse [gradle plugin](https://github.com/spring-projects/eclipse-integration-gradle). ([update site](http://dist.springsource.com/milestone/TOOLS/gradle)).
This is not used when building in eclipse since project can only imported using either gradle/eclipse plugin)

 4. For the application to be built in Eclipse, you need to create a `local.properties` file in the project directory containing the location of the Android SDK:

	`sdk.dir=<path>`

 5. Generate the Eclipse project files using gradle:

	```
	~$ ./gradlew build

	~$ ./gradlew cE e
	```
 

 6. Import the Calculator Android project into Eclipse as an **Android application**.

 
**From the command line:**

`gradle` wrapper is provided and must be used to build the project as we require gradle 1.10. To build and install the tool, run

```
~$ ./gradlew build
```


Running
-----

This project can either be executed as an Android application or it can be verified and tested on JPF or on the device.


**Running as an Android application in Eclipse:**

Right Click on project and select `Run As`->`Android Application`.

**or from Command line:**
To run a project built with gradle, we first need to update the `classpath` in all the `*.jpf` property files of the project. Currently the classpath will point to `project/bin/classes` (used by ant) Comment out this line and uncomment the classpath pointing to `build/classes/release`:

```sh
#classpath+=${jpf-android}/../Applications/Calculator/bin/classes/;${jpf-android}/../Applications/Calculator/libs/EvalEx-1.0.jar;

classpath+=${jpf-android}/../Applications/Calculator/build/classes/release;${jpf-android}/../Applications/Calculator/libs/EvalEx-1.0.jar;

```


Make sure the android tools directory is in your path:

```sh
# Start the emulator
android avd

# install app on the emulator
./gradlew installDebug

```


** Running on JPF-Android: **

 - Make sure the location of JPF-Android and JPF-CORE is specified in you site.properties file.
 - Import JPF-Core into Eclipse as a Java project.
 - Import JPF-Android from the location `jpf-android/jpf-android/` into Eclipse as a Java project.
 
The simplest way to run JPF-Android is to install the jpf eclipse plug-in from [here](http://babelfish.arc.nasa.gov/trac/jpf/wiki/install/eclipse-plugin)
            
Right click on a .jpf file. Select the Verify option and the verification process of the system specified in the .jpf file begins.

** Running monkeyrunner tests: **

** Running UI Automator tests: **

** Running JUnit tests: **

** Translating JPF-core script to monkeyrunner: **


Common Issues
--------------



License
-------

This software is distributed under the terms of the Apache Software License 2.0.
See the LICENSE file for further details.
